

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Animator &mdash; condynsate 0.7.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/autoclasstoc.css?v=08871587" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=fe7df9b0"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorials" href="../tutorials.html" />
    <link rel="prev" title="Keyboard Interactivity" href="gyro.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            condynsate
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../package.html">The condynsate Package</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../package.html#classes">Classes</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../package.html#examples">Examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="pendulum.html">condynsate.Simulator</a></li>
<li class="toctree-l3"><a class="reference internal" href="gyro.html">Keyboard Interactivity</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Animator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Setting-up-the-Simulation-Environment">Setting up the Simulation Environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Setting-up-the-Animator">Setting up the Animator</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Running-the-Simulation">Running the Simulation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">condynsate</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../package.html">The condynsate Package</a></li>
      <li class="breadcrumb-item active">Animator</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/cart.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Animator">
<h1>Animator<a class="headerlink" href="#Animator" title="Link to this heading"></a></h1>
<section id="Setting-up-the-Simulation-Environment">
<h2>Setting up the Simulation Environment<a class="headerlink" href="#Setting-up-the-Simulation-Environment" title="Link to this heading"></a></h2>
<p>Import necessary <code class="docutils literal notranslate"><span class="pre">condynsate</span></code> modules. Also import <code class="docutils literal notranslate"><span class="pre">numpy</span></code> for array management.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">condynsate</span><span class="w"> </span><span class="kn">import</span> <span class="n">Simulator</span> <span class="k">as</span> <span class="n">conSim</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">condynsate</span><span class="w"> </span><span class="kn">import</span> <span class="n">__assets__</span> <span class="k">as</span> <span class="n">assets</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</pre></div>
</div>
</div>
<p>Create a instance of <code class="docutils literal notranslate"><span class="pre">condynsate.simulator</span></code> that does not use the keyboard but does use the animator and the visualizer.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simulator</span> <span class="o">=</span> <span class="n">conSim</span><span class="p">(</span><span class="n">keyboard</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                   <span class="n">visualization</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                   <span class="n">visualization_fr</span> <span class="o">=</span> <span class="mf">24.0</span><span class="p">,</span>
                   <span class="n">animation</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                   <span class="n">animation_fr</span> <span class="o">=</span> <span class="mf">12.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
You can open the visualizer by visiting the following URL:
http://127.0.0.1:7000/static/
</pre></div></div>
</div>
<p>Load three large planes into the simulator to represent the ground and walls. Set <code class="docutils literal notranslate"><span class="pre">fixed</span> <span class="pre">=</span> <span class="pre">True</span></code> so that they are fixed in space, and set <code class="docutils literal notranslate"><span class="pre">update_vis</span> <span class="pre">=</span> <span class="pre">False</span></code>. Because the ground and walls will not move, there is no need to send updates to the visualizer. This saves resources. Further, adjust the position and rotation of the walls so they look good.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the ground</span>
<span class="n">ground</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">load_urdf</span><span class="p">(</span><span class="n">urdf_path</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;plane_big&#39;</span><span class="p">],</span>
                             <span class="n">fixed</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                             <span class="n">update_vis</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1"># Load the walls</span>
<span class="n">left_wall</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">load_urdf</span><span class="p">(</span><span class="n">urdf_path</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;plane_big&#39;</span><span class="p">],</span>
                                <span class="n">tex_path</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;concrete_img&#39;</span><span class="p">],</span> <span class="c1"># Choose a default texture for appearance</span>
                                <span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                                <span class="n">roll</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.5707</span><span class="p">,</span>
                                <span class="n">fixed</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                <span class="n">update_vis</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">right_wall</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">load_urdf</span><span class="p">(</span><span class="n">urdf_path</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;plane_big&#39;</span><span class="p">],</span>
                                 <span class="n">tex_path</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;concrete_img&#39;</span><span class="p">],</span>  <span class="c1"># Choose a default texture for appearance</span>
                                 <span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                                 <span class="n">roll</span> <span class="o">=</span> <span class="mf">1.5707</span><span class="p">,</span>
                                 <span class="n">fixed</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                 <span class="n">update_vis</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Load the cart into the simulator. Set <code class="docutils literal notranslate"><span class="pre">fixed</span> <span class="pre">=</span> <span class="pre">False</span></code> so that the cart is able to freely move. Set <code class="docutils literal notranslate"><span class="pre">update_vis</span> <span class="pre">=</span> <span class="pre">True</span></code> so that its position updates are reflected in the visualizer. Additionally, set the position to <code class="docutils literal notranslate"><span class="pre">[0.0,</span> <span class="pre">0.0,</span> <span class="pre">0.25]</span></code> so that its wheels rest on the ground plane, and set yaw to 90 degrees so that is moves in the Y plane.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cart</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">load_urdf</span><span class="p">(</span><span class="n">urdf_path</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="s1">&#39;cart&#39;</span><span class="p">],</span>
                           <span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">],</span>
                           <span class="n">yaw</span> <span class="o">=</span> <span class="mf">1.5707</span><span class="p">,</span>
                           <span class="n">fixed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                           <span class="n">update_vis</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Set the each wheel joint’s and the pendulum arm joint’s friction to some small value.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set joint damping</span>
<span class="n">joint_names</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;chassis_to_wheel_1&#39;</span><span class="p">,</span>
               <span class="s1">&#39;chassis_to_wheel_2&#39;</span><span class="p">,</span>
               <span class="s1">&#39;chassis_to_wheel_3&#39;</span><span class="p">,</span>
               <span class="s1">&#39;chassis_to_wheel_4&#39;</span><span class="p">,</span>
               <span class="s1">&#39;chassis_to_arm&#39;</span><span class="p">,)</span>
<span class="k">for</span> <span class="n">joint_name</span> <span class="ow">in</span> <span class="n">joint_names</span><span class="p">:</span>
    <span class="n">simulator</span><span class="o">.</span><span class="n">set_joint_damping</span><span class="p">(</span><span class="n">urdf_obj</span> <span class="o">=</span> <span class="n">cart</span><span class="p">,</span>
                               <span class="n">joint_name</span> <span class="o">=</span> <span class="n">joint_name</span><span class="p">,</span>
                               <span class="n">damping</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Set the initial angle of the pendulum. We denote that this is an initial condition with the <code class="docutils literal notranslate"><span class="pre">initial_cond</span> <span class="pre">=</span> <span class="pre">True</span></code> flag and we make the change instantaneously by using the <code class="docutils literal notranslate"><span class="pre">physics</span> <span class="pre">=</span> <span class="pre">False</span></code> flag.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">initial_angle</span> <span class="o">=</span> <span class="mf">0.1745</span>
<span class="n">simulator</span><span class="o">.</span><span class="n">set_joint_position</span><span class="p">(</span><span class="n">urdf_obj</span> <span class="o">=</span> <span class="n">cart</span><span class="p">,</span>
                             <span class="n">joint_name</span> <span class="o">=</span> <span class="s1">&#39;chassis_to_arm&#39;</span><span class="p">,</span>
                             <span class="n">position</span> <span class="o">=</span> <span class="n">initial_angle</span><span class="p">,</span> <span class="c1"># For a rotational joint, this value is in radians</span>
                             <span class="n">initial_cond</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                             <span class="n">physics</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Setting-up-the-Animator">
<h2>Setting up the Animator<a class="headerlink" href="#Setting-up-the-Animator" title="Link to this heading"></a></h2>
<p>Because we set <code class="docutils literal notranslate"><span class="pre">animator</span> <span class="pre">=</span> <span class="pre">True</span></code> in the simulator initialization, the animator is ready to add new plots to it. To do this we use the <code class="docutils literal notranslate"><span class="pre">condynsate.Simulator.add_plot</span></code> function.</p>
<p>In the first plot, we want to show the mean wheel torque as a function of time. To do so, we create a simple line plot. This is done with the argument <code class="docutils literal notranslate"><span class="pre">plot_type</span> <span class="pre">=</span> <span class="pre">'line'</span></code>. Further we add a title and axis labels with the <code class="docutils literal notranslate"><span class="pre">title</span> <span class="pre">=</span> <span class="pre">&quot;Torque</span> <span class="pre">vs</span> <span class="pre">Time&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">x_label</span> <span class="pre">=</span> <span class="pre">&quot;Time</span> <span class="pre">[Seconds]&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">y_label</span> <span class="pre">=</span> <span class="pre">&quot;Torque</span> <span class="pre">[Nm]&quot;</span></code>, respectively. Next, to format the line itself, we set its line width to 2.5 with <code class="docutils literal notranslate"><span class="pre">line_width</span> <span class="pre">=</span> <span class="pre">2.5</span></code>. Finally, we limit the y-axis view between -0.8 and 0.8 with
<code class="docutils literal notranslate"><span class="pre">y_lim</span> <span class="pre">=</span> <span class="pre">[-0.80,</span> <span class="pre">0.80]</span></code> and add a thin horizontal line across y=0 with <code class="docutils literal notranslate"><span class="pre">h_zero_line</span> <span class="pre">=</span> <span class="pre">True</span></code>. The return value of <code class="docutils literal notranslate"><span class="pre">condynsate.Simulator.add_plot</span></code> is the identifier of the plot just added. It will be used to later to tell the animator which plot to update when adding data points.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_1</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="n">plot_type</span> <span class="o">=</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
                            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Torque vs Time&quot;</span><span class="p">,</span>
                            <span class="n">x_label</span> <span class="o">=</span> <span class="s2">&quot;Time [Seconds]&quot;</span><span class="p">,</span>
                            <span class="n">y_label</span> <span class="o">=</span> <span class="s2">&quot;Torque [Nm]&quot;</span><span class="p">,</span>
                            <span class="n">line_width</span> <span class="o">=</span> <span class="mf">2.5</span><span class="p">,</span>
                            <span class="n">y_lim</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.80</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">],</span>
                            <span class="n">h_zero_line</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now we want another line plot that shows both the pendulum angle and mean wheel angle simultaneously. Because we want two lines on this plot, we call for 2 artists, one for each line. All other arguments are similar aside for <code class="docutils literal notranslate"><span class="pre">labels</span> <span class="pre">=</span> <span class="pre">[&quot;Pendulum&quot;,</span> <span class="pre">&quot;Wheel&quot;]</span></code> which tells the animator what each arist should be called for the legend. Further, when multiple artists are used <code class="docutils literal notranslate"><span class="pre">color</span></code>, <code class="docutils literal notranslate"><span class="pre">line_width</span></code>, and <code class="docutils literal notranslate"><span class="pre">line_style</span></code> may either be a single argument (applied to all artists) or a list of arguemnts
with length equal to number of artists. When <code class="docutils literal notranslate"><span class="pre">n_artists</span> <span class="pre">&gt;</span> <span class="pre">1</span></code>, the return value of <code class="docutils literal notranslate"><span class="pre">condynsate.Simulator.add_plot</span></code> is the identifier of the plot just added and a tuple of artist identifiers (one for each artist). These will also be used to later to tell the animator which plot adn artist to update when adding data points.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_2</span><span class="p">,</span> <span class="n">plot_2_artists</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="n">n_artists</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                                            <span class="n">plot_type</span> <span class="o">=</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
                                            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Angles vs Time&quot;</span><span class="p">,</span>
                                            <span class="n">x_label</span> <span class="o">=</span> <span class="s2">&quot;Time [Seconds]&quot;</span><span class="p">,</span>
                                            <span class="n">y_label</span> <span class="o">=</span> <span class="s2">&quot;Angles [Rad]&quot;</span><span class="p">,</span>
                                            <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">],</span> <span class="c1"># One color for each artist</span>
                                            <span class="n">line_width</span> <span class="o">=</span> <span class="mf">2.5</span><span class="p">,</span>   <span class="c1"># Single value to give all artists same line_width</span>
                                            <span class="n">line_style</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>   <span class="c1"># Single value to give all artists same line_style</span>
                                            <span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Pendulum&quot;</span><span class="p">,</span> <span class="s2">&quot;Wheel&quot;</span><span class="p">],</span> <span class="c1"># One label for each artist</span>
                                            <span class="n">h_zero_line</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Finally, we would like a bar plot that shows each wheel’s deviation from the mean wheel angle. To do so, we add a new plot of type <code class="docutils literal notranslate"><span class="pre">'bar'</span></code> with 4 artists. This time, we also add a thin verticle line along x=0 so we can see if the wheel deviation is leading or lagging the mean. Also, we fix the x axis limits so it is easier to read.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_3</span><span class="p">,</span> <span class="n">plot_3_artists</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="n">n_artists</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
                                            <span class="n">plot_type</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span>
                                            <span class="n">x_lim</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span>
                                            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Wheel Deviation from Mean&quot;</span><span class="p">,</span>
                                            <span class="n">x_label</span> <span class="o">=</span> <span class="s2">&quot;Deviation [Rad]&quot;</span><span class="p">,</span>
                                            <span class="n">y_label</span> <span class="o">=</span> <span class="s2">&quot;Wheel Number&quot;</span><span class="p">,</span>
                                            <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span>
                                            <span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;W1&quot;</span><span class="p">,</span> <span class="s2">&quot;W2&quot;</span><span class="p">,</span> <span class="s2">&quot;W3&quot;</span><span class="p">,</span> <span class="s2">&quot;W4&quot;</span><span class="p">],</span>
                                            <span class="n">v_zero_line</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The plots are now set up how we want, so we can open the animator GUI. Once opened, no additional plots can be added. Note: <code class="docutils literal notranslate"><span class="pre">%%capture</span></code> is required to supress the animator drawing the first frame to this notebook. Though it is not required, it is reccomended. It must be the first line in the cell in which it’s called.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="n">simulator</span><span class="o">.</span><span class="n">start_animator</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>As expected, a figure with our three plots opens.</p>
</section>
<section id="Running-the-Simulation">
<h2>Running the Simulation<a class="headerlink" href="#Running-the-Simulation" title="Link to this heading"></a></h2>
<p>Run the simulation in a loop. Begin by resetting the simulation using <code class="docutils literal notranslate"><span class="pre">condynsate.Simulator.reset</span></code> to reset the simulation to an initial state. Then we create a simulation loop. The loop terminates when the flag <code class="docutils literal notranslate"><span class="pre">condynsate.Simulator.is_done</span></code> flips to True. In each time step of the simulation loop we do four things:</p>
<ol class="arabic simple">
<li><p>Take a simulation time step.</p></li>
<li><p>If a successful simulation step was taken, read the wheel angles, wheel angular velocities, pendulum angle, and pendulum angular velocity. Successful simulation steps are indicated by <code class="docutils literal notranslate"><span class="pre">condynsate.Simulator.step</span></code> having a <code class="docutils literal notranslate"><span class="pre">ret_code</span></code> greater than <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p></li>
<li><p>If a successful simulation step was taken, apply torques to wheels based on the mean wheel angle, mean wheel angular velocity, pendulum angle, and pendulum angular velocity.</p></li>
<li><p>If a successful simulation step was taken, update the animator.</p></li>
</ol>
<p>Let’s start by making a function that reads each angle and angular velocity we want.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">read_states</span><span class="p">(</span><span class="n">simulator</span><span class="p">,</span> <span class="n">cart</span><span class="p">):</span>
    <span class="c1"># Define which joints to read</span>
    <span class="n">joint_names</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;chassis_to_wheel_1&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;chassis_to_wheel_2&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;chassis_to_wheel_3&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;chassis_to_wheel_4&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;chassis_to_arm&#39;</span><span class="p">,)</span>

    <span class="c1"># Loop over each joint and read the state extracting angle and angular vel.</span>
    <span class="n">angles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">angular_vels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">joint_name</span> <span class="ow">in</span> <span class="n">joint_names</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">get_joint_state</span><span class="p">(</span><span class="n">urdf_obj</span> <span class="o">=</span> <span class="n">cart</span><span class="p">,</span>
                                          <span class="n">joint_name</span> <span class="o">=</span> <span class="n">joint_name</span><span class="p">)</span>
        <span class="n">angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">])</span>
        <span class="n">angular_vels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;velocity&#39;</span><span class="p">])</span>

    <span class="c1"># For the wheels, return the mean angle and angular vel.</span>
    <span class="n">mean_wheel_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">angles</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">mean_wheel_ang_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">angular_vels</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Additionally, calculate the wheel deviation from mean.</span>
    <span class="n">wheel_deviations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">wheel_angle</span> <span class="ow">in</span> <span class="n">angles</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">wheel_deviations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wheel_angle</span> <span class="o">-</span> <span class="n">mean_wheel_angle</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">mean_wheel_angle</span><span class="p">,</span> <span class="n">mean_wheel_ang_vel</span><span class="p">),</span> <span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">angular_vels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">wheel_deviations</span>
</pre></div>
</div>
</div>
<p>Next we make a function that applies torque based on the state we read.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">apply_torque</span><span class="p">(</span><span class="n">simulator</span><span class="p">,</span> <span class="n">cart</span><span class="p">,</span> <span class="n">mean_wheel_state</span><span class="p">,</span> <span class="n">pendulum_state</span><span class="p">):</span>
    <span class="c1"># Calculate the torque via magic</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="o">-</span><span class="mf">2.</span> <span class="p">,</span>  <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.</span> <span class="p">,</span>  <span class="o">-</span><span class="mf">0.1</span><span class="p">]])</span>
    <span class="n">m_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">n_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">pendulum_state</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                  <span class="p">[</span><span class="n">mean_wheel_state</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                  <span class="p">[</span><span class="n">pendulum_state</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                  <span class="p">[</span><span class="n">mean_wheel_state</span><span class="p">[</span><span class="mi">0</span><span class="p">]]])</span>
    <span class="n">torque</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">K</span><span class="o">@</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">m_e</span><span class="p">)</span> <span class="o">+</span> <span class="n">n_e</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">torque</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">torque</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">)</span>

    <span class="c1"># Define which joints we apply torque to</span>
    <span class="n">joint_names</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;chassis_to_wheel_1&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;chassis_to_wheel_2&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;chassis_to_wheel_3&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;chassis_to_wheel_4&#39;</span><span class="p">,)</span>

    <span class="c1"># Apply the torque we calculated</span>
    <span class="k">for</span> <span class="n">joint_name</span> <span class="ow">in</span> <span class="n">joint_names</span><span class="p">:</span>
        <span class="n">simulator</span><span class="o">.</span><span class="n">set_joint_torque</span><span class="p">(</span><span class="n">urdf_obj</span> <span class="o">=</span> <span class="n">cart</span><span class="p">,</span>
                                   <span class="n">joint_name</span> <span class="o">=</span> <span class="n">joint_name</span><span class="p">,</span>
                                   <span class="n">torque</span> <span class="o">=</span> <span class="n">torque</span><span class="p">,</span>
                                   <span class="n">show_arrow</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="c1"># Define arrow params to visualize the torque</span>
                                   <span class="n">arrow_scale</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
                                   <span class="n">arrow_offset</span> <span class="o">=</span> <span class="mf">0.025</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">torque</span>
</pre></div>
</div>
</div>
<p>Next we want to build a function that updates the first line plot. We want this function to add a single datum to the end of the data list being plotted as a line. To do this, we will use the <code class="docutils literal notranslate"><span class="pre">condynsate.Simulator.add_line_datum</span></code> function. The arguments to this function are the plot to which the point is added and the (x,y) coordinates of the point. The x coordinate will be simulation time which we extract with <code class="docutils literal notranslate"><span class="pre">condynsate.Simulator.time</span></code>, and the y coordinate is the torque we calculated in
the previous function. After <code class="docutils literal notranslate"><span class="pre">condynsate.Simulator.add_line_datum</span></code> is called, the animator automatically updates to add the point at the specified frame rate.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">add_torque_point</span><span class="p">(</span><span class="n">simulator</span><span class="p">,</span> <span class="n">plot_id</span><span class="p">,</span> <span class="n">torque</span><span class="p">):</span>
    <span class="n">simulator</span><span class="o">.</span><span class="n">add_line_datum</span><span class="p">(</span><span class="n">plot_id</span> <span class="o">=</span> <span class="n">plot_id</span><span class="p">,</span>
                             <span class="n">x</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                             <span class="n">y</span> <span class="o">=</span> <span class="n">torque</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We build a similar function for the wheel and pendulum angles, but this time the plot has 2 artists. Therefore, we need to specify to which artist we are adding the data points. This is done with the <code class="docutils literal notranslate"><span class="pre">artist_id</span></code> argument.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">add_state_points</span><span class="p">(</span><span class="n">simulator</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="n">plot_artists</span><span class="p">,</span> <span class="n">mean_wheel_state</span><span class="p">,</span> <span class="n">pendulum_state</span><span class="p">):</span>
    <span class="n">simulator</span><span class="o">.</span><span class="n">add_line_datum</span><span class="p">(</span><span class="n">plot_id</span> <span class="o">=</span> <span class="n">plot</span><span class="p">,</span>
                             <span class="n">artist_id</span> <span class="o">=</span> <span class="n">plot_artists</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="c1"># Draw to the first artist (whose label is &quot;Pendulum&quot;)</span>
                             <span class="n">x</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                             <span class="n">y</span> <span class="o">=</span> <span class="n">pendulum_state</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">simulator</span><span class="o">.</span><span class="n">add_line_datum</span><span class="p">(</span><span class="n">plot_id</span> <span class="o">=</span> <span class="n">plot</span><span class="p">,</span>
                             <span class="n">artist_id</span> <span class="o">=</span> <span class="n">plot_artists</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="c1"># Draw to the second artist (whose label is &quot;Wheel&quot;)</span>
                             <span class="n">x</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                             <span class="n">y</span> <span class="o">=</span> <span class="n">mean_wheel_state</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>Now we want a function to edit the bar chart. This is very similar to <code class="docutils literal notranslate"><span class="pre">add_state_points</span></code>, however we use the function ‘condynsate.Simulator.set_bar_value’ to edit a bar chart’s values.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">set_deviation_values</span><span class="p">(</span><span class="n">simulator</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="n">plot_artists</span><span class="p">,</span> <span class="n">wheel_deviations</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">plot_artist</span><span class="p">,</span> <span class="n">wheel_deviation</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">plot_artists</span><span class="p">,</span> <span class="n">wheel_deviations</span><span class="p">):</span>
        <span class="n">simulator</span><span class="o">.</span><span class="n">set_bar_value</span><span class="p">(</span><span class="n">plot_id</span> <span class="o">=</span> <span class="n">plot</span><span class="p">,</span>
                                <span class="n">artist_id</span> <span class="o">=</span> <span class="n">plot_artist</span><span class="p">,</span>
                                <span class="n">value</span> <span class="o">=</span> <span class="n">wheel_deviation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Finally, we build our simulation loop. By setting the <code class="docutils literal notranslate"><span class="pre">real_time</span> <span class="pre">=</span> <span class="pre">True</span></code> flag and <code class="docutils literal notranslate"><span class="pre">max_time</span> <span class="pre">=</span> <span class="pre">10.0</span></code> in <code class="docutils literal notranslate"><span class="pre">condynsate.Simulator.step</span></code>, we tell the simulation to attempt to run in real time for 5 seconds.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reset before running a simulation loop</span>
<span class="n">simulator</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

<span class="c1"># Run the simulation loop</span>
<span class="k">while</span><span class="p">(</span><span class="ow">not</span> <span class="n">simulator</span><span class="o">.</span><span class="n">is_done</span><span class="p">):</span>
    <span class="c1"># Step the sim</span>
    <span class="n">ret_code</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">real_time</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                              <span class="n">max_time</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">)</span>

    <span class="c1"># If successful step was taken</span>
    <span class="k">if</span> <span class="n">ret_code</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Read the states and apply the torque</span>
        <span class="n">mean_wheel_state</span><span class="p">,</span> <span class="n">pendulum_state</span><span class="p">,</span> <span class="n">wheel_deviations</span> <span class="o">=</span> <span class="n">read_states</span><span class="p">(</span><span class="n">simulator</span><span class="p">,</span> <span class="n">cart</span><span class="p">)</span>
        <span class="n">torque</span> <span class="o">=</span> <span class="n">apply_torque</span><span class="p">(</span><span class="n">simulator</span><span class="p">,</span> <span class="n">cart</span><span class="p">,</span> <span class="n">mean_wheel_state</span><span class="p">,</span> <span class="n">pendulum_state</span><span class="p">)</span>

        <span class="c1"># Add the new data points to the animator</span>
        <span class="n">add_torque_point</span><span class="p">(</span><span class="n">simulator</span><span class="p">,</span> <span class="n">plot_1</span><span class="p">,</span> <span class="n">torque</span><span class="p">)</span>
        <span class="n">add_state_points</span><span class="p">(</span><span class="n">simulator</span><span class="p">,</span> <span class="n">plot_2</span><span class="p">,</span> <span class="n">plot_2_artists</span><span class="p">,</span> <span class="n">mean_wheel_state</span><span class="p">,</span> <span class="n">pendulum_state</span><span class="p">)</span>
        <span class="n">set_deviation_values</span><span class="p">(</span><span class="n">simulator</span><span class="p">,</span> <span class="n">plot_3</span><span class="p">,</span> <span class="n">plot_3_artists</span><span class="p">,</span> <span class="n">wheel_deviations</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Watch as the pendulum magically balances while the torque and angles are plotted in real time on the animator GUI.</p>
<p>Once the simulation is done, we terminate the animator</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simulator</span><span class="o">.</span><span class="n">terminate_animator</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="gyro.html" class="btn btn-neutral float-left" title="Keyboard Interactivity" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../tutorials.html" class="btn btn-neutral float-right" title="Tutorials" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, G. Schaer.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>